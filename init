#!/bin/execlineb -P
emptyenv
umask 022
s6-envdir -If /etc/rc/env
s6-setsid -bq
if { mount -no nodev,noexec,nosuid -t proc proc /proc }
if { mount -no mode=0755,nosuid,size=1M -t devtmpfs dev /dev }
if { mount -no mode=0755,nodev,nosuid,size=64M -t tmpfs run /run }
if { cp -pR /etc/rc/image /run/service }
if { mkfifo -m 0600 /run/service/logger/fifo }
redirfd -r 0 /dev/null
redirfd -bnw 1 /run/service/logger/fifo
fdmove -c 2 1
background {
  s6-setsid
  redirfd -w 1 /run/service/logger/fifo
  if { s6-rc-init -c /etc/rc/compiled -t 1000 /run/service }
  s6-rc -pu change default
}
unexport !
cd /run/service
s6-svscan -s
